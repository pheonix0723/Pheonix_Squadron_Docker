{% extends "navBar.html" %}
{% block content %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Retinal Disease Detection</title>
  <!-- Add your CSS file link here -->
  <link rel="stylesheet" href="/static/css/styles.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/fontawesome.min.css"
    integrity="sha384-QYIZto+st3yW+o8+5OHfT6S482Zsvz2WfOzpFSXMF9zqeLcFV0/wlZpMtyFcZALm" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.9/dist/flatpickr.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.9/dist/flatpickr.min.css">
  <script src="https://d3js.org/d3.v6.min.js"></script>

</head>

<body>

  <section id="Analysis">
        <div class="dropdrown">
          <form class="form-inline" id="form-inline" style="padding-left: 180px;" action="/getdata" method="POST">
            <h4 style="color:rgb(20, 49, 77)">Search for a Report ?</h4>
            <div class="row ">
              <div class="col-md-4">
                <select class="form-control" name="patient_Id" id="patient_Id" required>
                  
                  <option selected value = "None">Select Patient ID</option>
                  <option value="100905335981">100905335981 - Aseem  Shaik</option>
                  <option value="791086626579">791086626579 - Neelima Chekuri</option>
                  <option value="525571517882">525571517882 - Ravi Ramulu </option>
                  <option value="547962351076">547962351076 - Suraj Kumar </option>
                  <option value="606040492118">606040492118 - Thomas Jefferson</option>
                  <option value="696391717790">696391717790 - Salman Raza </option>
                  <option value="638243026837">638243026837 - Mounika Maddala </option>
                  <option value="908045474911">908045474911 - Narasimha Parthasarathi </option>
                  <option value="910208945898">910208945898 - Jithendra Sharma </option>
                  <option value="872356541347">872356541347 - Poojitha Veera</option>
                  <option value="853819839067">853819839067 - Fatima Begam</option>
                  <option value="798905719115">798905719115 - Prashanth Neelam</option>
                  <option value="612384377768">612384377768 - Vineeta Gupta</option>
                  <option value="658217614610">658217614610 - Shilpa Iyyengar</option>
                  <option value="742754687224">742754687224 - Ritu Tiwari</option>
                  <option value="959092867159">959092867159 - Karan Rajputh</option>
                  <option value="098767853523">098767853523 - Ratnala Sunil</option>
                  <option value="856797402725">856797402725 - Gayatri Mamaidala</option>
                  <option value="514410894254">514410894254 - Priya Johar</option>
    
                </select>
              </div>
              <div class="col-md-4 ">
                <button type="submit" class="btn btn-primary mb-2">Submit</button>
              </div>
            </div>
          </form>
        </div>
    
    {% if img %}
      <section id = "report">
        <div class="reportcard">
          <!-- <div class="row" style="margin-right:0px;important;padding-right:0px;width: 960px;">
            <div class="card3" style="width:850px;">
              <div class="card-body6" >Name : {{patient_Name}}</div>
            </div>
          </div> -->
          <br>
    
          <div class="row">
            <div class="col-md-5">
              <div class="image-box" style = "height: 300px; width: 700x;">
                <img src="{{ img }}" alt = "Image Not Found">
              </div>
            </div>
    
            <div class="col-md-6">

              <div class = "row" style="width: 450px;">
                <div class="card4" >
                  <div class="card-body7">Name : {{patient_Name}}</div>
                </div>
              </div>
              <br>

              <div class="row" style="width: 450px;">
                <div class="card4" >
                  <div class="card-body7">Date of Test : {{ test_Date }}</div>
                </div>
              </div>
              <br>
    
              <div class="row" style="padding-left: 40px;">
                <div class="col-md-6">
                  <div class="card5" style="width:200px;">
                      <div class="card-body7" id = "age_Display"></div>
                  </div>
                </div>

                <div class="col-md-6" style="padding-left: 30px;">
                  <div class="card5" style="width:200px;">
                      <div class="card-body7" >Gender : {{patient_Gender}}</div>
                  </div>
                </div>
              </div>

              <br>

              <div class="row" >
                <div class="col-md-6" style="padding-left: 30px;">
                  <svg id="dr_Meter" width="400" height="300"></svg>
                </div>
                <div class="col-md-6" style="padding-left: 30px;" >
                  <svg id="hyper_Meter" width="400" height="300" style="padding-top:0px;"></svg>
                </div>
              </div>
              <br>

            </div>
            
          </div>
        </div>
      </section>
      <!-- </div> -->
      <!-- <div class="col-md-6" style="padding-left: 320px;">
        <svg id="dr_Meter" width="400" height="300"></svg>
        <svg id="hyper_Meter" width="400" height="300" style="padding-top:0px;"></svg>
      </div> -->
    <!-- </div> -->
    {% endif %}
  </section>
      
  <script>

      // import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
      // Declare the chart dimensions and margins.
      radial_Meter("#dr_Meter", "Diabetes", '{{ probability }}');
      radial_Meter("#hyper_Meter", "Hypertension", 29.49);
      // (Math.random() * 100).toPrecision(4)
      function radial_Meter(div_Id, title, percentage){
        const minValue = 0;
        const maxValue = 100;
        const currentValue = percentage;
        var level = "#f9fc5f";
        if (currentValue > 60) level = "#fb5252";
        if (currentValue < 30) level = "green";

        const width = 250;
        const height = 180;

        const radius = Math.min(width, height) / 2;
        const centerX = width / 2;
        const centerY = height / 2 + 1;

        const arcStartAngle = -90 * (Math.PI / 180);
        const arcEndAngle = 90 * (Math.PI / 180); 

        const arc_Border = d3.arc()
        .innerRadius(radius - 20)
        .outerRadius(radius)
        .startAngle(arcStartAngle)
        .endAngle(arcEndAngle); 
    
        const arc = d3.arc()
          .innerRadius(radius - 20)
          .outerRadius(radius)
          .startAngle(arcStartAngle)
          .endAngle(arcStartAngle + (currentValue / (maxValue - minValue)) * (arcEndAngle - arcStartAngle)); 

        const svg = d3.select(div_Id)
          .attr("width", width)
          .attr("height", height);

        const gauge = svg.append("g")
          .attr("transform", `translate(${centerX}, ${centerY})`);

        gauge.append("path")
          .attr("d", arc_Border)
          .attr("fill", "none")
          .attr("stroke", "lightgray")
          .attr("stroke-width", 3);

        // Filling the colored portion
        gauge.append("path")
          .attr("d", arc)
          .attr("fill", level);

        // const pointerLength = radius - 30;
        // const pointer = gauge.append("line")
        //   .attr("x1", 0)
        //   .attr("y1", 0)
        //   .attr("x2", pointerLength)
        //   .attr("y2", 0)
        //   .attr("stroke", "red")
        //   .attr("stroke-width", 3)
        //   .attr("transform", `rotate(${(currentValue / (maxValue - minValue)) * 180 + 180})`);

        // Adding labels and title
        const labelGroup = gauge.append("g")
          .attr("class", "labels");

        labelGroup.append("text")
          .attr("class", "min-label")
          .attr("x", -radius + 3)
          .attr("y", 30)
          .style("font-size", "20px")
          // .style("font-weight", "bold")
          .text(minValue);

        labelGroup.append("text")
          .attr("class", "max-label")
          .attr("x", radius - 25)
          .attr("y", 30)
          .style("font-size", "20px")
          // .style("font-weight", "bold")
          .text(maxValue);

        labelGroup.append("text")
          .attr("class", "percentage-label")
          .attr("x", 5)
          .attr("y", -15)
          .style("text-anchor", "middle")
          .style("font-size", "25px")
          .style("font-weight", "bold")
          .text(`${currentValue}%`);

        labelGroup.append("text")
          .attr("class", "title")
          .attr("x", 0)
          .attr("y", 25)
          .style("text-anchor", "middle")
          .style("font-size", "19px")
          .text(title);

        // Append the SVG element.
        // dr_Meter.append(guage);
    }

      function removeTable() {
      var table = document.getElementById("patientTable");
      table.style.display = "none";
    }

    function calculate_Age(dateOfBirth) {
      var today = new Date();
      var birthDate = new Date(dateOfBirth);

      var yearsDiff = today.getFullYear() - birthDate.getFullYear();

      if (today.getMonth() < birthDate.getMonth() ||
        (today.getMonth() === birthDate.getMonth() && today.getDate() < birthDate.getDate())) 
          {yearsDiff--;}
      return yearsDiff;
    }

    var ageDisplay = document.getElementById('age_Display');
    ageDisplay.textContent = "Age : " + calculate_Age("{{patient_Dob}}");

  </script>

</body>

</html>
{% endblock %}